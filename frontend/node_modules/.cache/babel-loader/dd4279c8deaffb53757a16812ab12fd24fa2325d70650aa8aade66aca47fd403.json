{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Navigate,useLocation}from'react-router-dom';import{useQuery}from'react-query';import apiService from'../services/api';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const ProtectedRoute=_ref=>{let{children,requiredPermissions=[]}=_ref;const location=useLocation();const[isAuthenticated,setIsAuthenticated]=useState(null);// Check if user is authenticated\nconst{data:user,isLoading,error}=useQuery(['currentUser'],apiService.users.getCurrentUser,{retry:false,onSuccess:data=>{setIsAuthenticated(true);// Check if user has required permissions\nif(requiredPermissions.length>0){const hasAllPermissions=requiredPermissions.every(permission=>data.hasOwnProperty(permission)&&data[permission]);if(!hasAllPermissions){setIsAuthenticated(false);}}},onError:()=>{setIsAuthenticated(false);}});useEffect(()=>{const token=localStorage.getItem('access_token');if(!token){setIsAuthenticated(false);}},[]);// Show loading spinner while checking authentication\nif(isLoading||isAuthenticated===null){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gray-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-4 text-gray-600\",children:\"Loading...\"})]})});}// Redirect to login if not authenticated\nif(!isAuthenticated){return/*#__PURE__*/_jsx(Navigate,{to:\"/login\",state:{from:location},replace:true});}// Show access denied if user doesn't have required permissions\nif(requiredPermissions.length>0&&user){const hasAllPermissions=requiredPermissions.every(permission=>user.hasOwnProperty(permission)&&user[permission]);if(!hasAllPermissions){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gray-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mx-auto h-16 w-16 bg-red-100 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"h-8 w-8 text-red-600\",fill:\"none\",viewBox:\"0 0 24 24\",stroke:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\"})})}),/*#__PURE__*/_jsx(\"h2\",{className:\"mt-6 text-2xl font-bold text-gray-900\",children:\"Access Denied\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-gray-600\",children:\"You don't have permission to access this page.\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-6\",children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.history.back(),className:\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700\",children:\"Go Back\"})})]})});}}return/*#__PURE__*/_jsx(_Fragment,{children:children});};export default ProtectedRoute;","map":{"version":3,"names":["React","useEffect","useState","Navigate","useLocation","useQuery","apiService","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","ProtectedRoute","_ref","children","requiredPermissions","location","isAuthenticated","setIsAuthenticated","data","user","isLoading","error","users","getCurrentUser","retry","onSuccess","length","hasAllPermissions","every","permission","hasOwnProperty","onError","token","localStorage","getItem","className","to","state","from","replace","fill","viewBox","stroke","strokeLinecap","strokeLinejoin","strokeWidth","d","onClick","window","history","back"],"sources":["/home/ubuntu/vicky/I2I projects/Inventory management/frontend/src/components/ProtectedRoute.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Navigate, useLocation } from 'react-router-dom';\nimport { useQuery } from 'react-query';\nimport apiService from '../services/api';\nimport { UserWithPermissions } from '../types';\n\ninterface ProtectedRouteProps {\n  children: React.ReactNode;\n  requiredPermissions?: string[];\n}\n\nconst ProtectedRoute: React.FC<ProtectedRouteProps> = ({ \n  children, \n  requiredPermissions = [] \n}) => {\n  const location = useLocation();\n  const [isAuthenticated, setIsAuthenticated] = useState<boolean | null>(null);\n\n  // Check if user is authenticated\n  const { data: user, isLoading, error } = useQuery(\n    ['currentUser'],\n    apiService.users.getCurrentUser,\n    {\n      retry: false,\n      onSuccess: (data: UserWithPermissions) => {\n        setIsAuthenticated(true);\n        \n        // Check if user has required permissions\n        if (requiredPermissions.length > 0) {\n          const hasAllPermissions = requiredPermissions.every(permission =>\n            data.hasOwnProperty(permission) && (data as any)[permission]\n          );\n          \n          if (!hasAllPermissions) {\n            setIsAuthenticated(false);\n          }\n        }\n      },\n      onError: () => {\n        setIsAuthenticated(false);\n      },\n    }\n  );\n\n  useEffect(() => {\n    const token = localStorage.getItem('access_token');\n    if (!token) {\n      setIsAuthenticated(false);\n    }\n  }, []);\n\n  // Show loading spinner while checking authentication\n  if (isLoading || isAuthenticated === null) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto\"></div>\n          <p className=\"mt-4 text-gray-600\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Redirect to login if not authenticated\n  if (!isAuthenticated) {\n    return <Navigate to=\"/login\" state={{ from: location }} replace />;\n  }\n\n  // Show access denied if user doesn't have required permissions\n  if (requiredPermissions.length > 0 && user) {\n    const hasAllPermissions = requiredPermissions.every(permission =>\n      user.hasOwnProperty(permission) && (user as any)[permission]\n    );\n    \n    if (!hasAllPermissions) {\n      return (\n        <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n          <div className=\"text-center\">\n            <div className=\"mx-auto h-16 w-16 bg-red-100 rounded-full flex items-center justify-center\">\n              <svg className=\"h-8 w-8 text-red-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\" />\n              </svg>\n            </div>\n            <h2 className=\"mt-6 text-2xl font-bold text-gray-900\">Access Denied</h2>\n            <p className=\"mt-2 text-gray-600\">\n              You don't have permission to access this page.\n            </p>\n            <div className=\"mt-6\">\n              <button\n                onClick={() => window.history.back()}\n                className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700\"\n              >\n                Go Back\n              </button>\n            </div>\n          </div>\n        </div>\n      );\n    }\n  }\n\n  return <>{children}</>;\n};\n\nexport default ProtectedRoute; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}